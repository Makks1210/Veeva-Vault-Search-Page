<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Veeva QDocs</title>
<style>
        /* Your existing styles */
</style>
</head>
<body>
<div class="container">
<div id="search-section">
<h1>Veeva QDocs</h1>
<input type="text" id="search-input" placeholder="Search Qdocs Object...." class="search-bar" required>
<button class="search-button" onclick="performSearch()">Search</button>
<div id="error-message" style="color: red; margin-top: 10px;"></div>
</div>
 
        <div id="login-section" style="display: none;">
<h1>Login</h1>
<input type="text" id="username" placeholder="Enter Username" class="login-input" required><br>
<input type="password" id="password" placeholder="Enter Password" class="login-input" required><br>
<button class="login-button" onclick="performLogin()">Fetch Metadata</button>
<div id="table-container"></div>
<div id="login-error-message" style="color: red; margin-top: 10px;"></div>
</div>
 
        <table id="metadata-table">
<thead>
<tr>
<th>Object Label</th>
<th>Name</th>
<th>Status</th>
<th>Configuration State</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
 
    <script>
        function performSearch() {
            const query = document.getElementById('search-input').value.trim().toLowerCase();
            if (query === 'qdocs') {
                document.getElementById('search-section').style.display = 'none';
                document.getElementById('login-section').style.display = 'block';
                document.getElementById('error-message').innerText = ''; 
            } else {
                document.getElementById('error-message').innerText = 'Error: Please enter "Qdocs" to proceed.';
            }
        }
 
        async function performLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const formData = new URLSearchParams();
            formData.append('username', username);
            formData.append('password', password);
 
            try {
                const loginResponse = await fetch('http://localhost:3000/proxy/api/v24.1/auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData
                });
 
                if (!loginResponse.ok) {
                    const errorText = await loginResponse.text();
                    throw new Error('Login failed: ' + errorText);
                }
 
                const loginData = await loginResponse.json();
                const sessionId = loginData.sessionId;
 
                const metadataResponse = await fetch('http://localhost:3000/proxy/api/v24.1/metadata/vobjects', {
                    method: 'GET',
                    headers: {
                        'Authorization': sessionId,
                        'Accept': 'application/json'
                    }
                });
 
                if (!metadataResponse.ok) {
                    const metadataErrorText = await metadataResponse.text();
                    throw new Error('Metadata fetch failed: ' + metadataErrorText);
                }
 
                const metadata = await metadataResponse.json();
                displayMetadataInTable(metadata.objects);
 
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('login-error-message').innerText = error.message;
            }
        }
 
        function displayMetadataInTable(objects) {
            const tableBody = document.getElementById('metadata-table').querySelector('tbody');
            tableBody.innerHTML = '';
 
            const rows = objects.filter(obj => obj.name.endsWith('__sys')).map(obj => `
<tr>
<td>${obj.label}</td>
<td>${obj.name}</td>
<td>${obj.status.join(', ')}</td>
<td>${obj.configuration_state}</td>
</tr>
            `).join('');
 
            tableBody.innerHTML += rows;
            document.getElementById('metadata-table').style.display = 'table'; 
        }
</script>
</body>
</html>
